# ===================================================================
# Root Netlify configuration for Efficio monorepo
# ===================================================================

# ðŸ§± Default build (fallback - usually unused)
[build]
  command = "echo 'Specify context for each site in Netlify UI'"
  publish = "dist"

# -------------------------------------------------------------------
# ðŸ§© DASHBOARD APP SHELL
# -------------------------------------------------------------------
[context.app_shell]
  base = "apps/dashboard-app-shell"
  command = "pnpm build:app-shell"
  publish = "apps/dashboard-app-shell/dist"

  # âœ… Ignore build if no files changed in app-shell
  [context.app_shell.ignore]
    command = "git diff --quiet HEAD^ HEAD -- apps/dashboard-app-shell/"

# -------------------------------------------------------------------
# ðŸ§© TASK MANAGER
# -------------------------------------------------------------------
[context.task_manager]
  base = "apps/task-manager"
  command = "pnpm build"
  publish = "apps/task-manager/dist"

  # âœ… Ignore build if no files changed in task-manager
  [context.task_manager.ignore]
    command = "git diff --quiet HEAD^ HEAD -- apps/task-manager/"

# -------------------------------------------------------------------
# ðŸ§© TIME TRACKER
# -------------------------------------------------------------------
[context.time_tracker]
  base = "apps/time-tracker"
  command = "pnpm build"
  publish = "apps/time-tracker/dist"

  # âœ… Ignore build if no files changed in time-tracker
  [context.time_tracker.ignore]
    command = "git diff --quiet HEAD^ HEAD -- apps/time-tracker/"

# -------------------------------------------------------------------
# ðŸ§© ANALYTICS
# -------------------------------------------------------------------
[context.analytics]
  base = "apps/analytics"
  command = "pnpm build"
  publish = "apps/analytics/dist"

  # âœ… Ignore build if no files changed in analytics
  [context.analytics.ignore]
    command = "git diff --quiet HEAD^ HEAD -- apps/analytics/"

# -------------------------------------------------------------------
# ðŸ§­ Redirect rule (for all SPAs)
# -------------------------------------------------------------------
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
